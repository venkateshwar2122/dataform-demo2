config {
  type: "table",
  schema: "analytics2"
}

select
  customer_id,
  sum(amount) as lifetime_value,
  count(distinct order_id) as total_orders
from
  ${ref("sales_cleaned")}
where status = "completed"
group by customer_id
